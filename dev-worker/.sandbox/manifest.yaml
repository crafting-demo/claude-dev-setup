hooks:
  post-checkout:
    cmd: |      
      export CLI_SCRIPT=y
      mkdir -p "$HOME/claude"      
      mkdir -p "$HOME/cmd"

      # Ensure Go toolchain for Go worker path
      if [ -f "$HOME/claude/dev-worker/setup-go.sh" ]; then
        bash "$HOME/claude/dev-worker/setup-go.sh" || echo "Warning: setup-go.sh failed"
      fi

      # Ensure PATH includes common install locations and user-local Go
      export PATH="$HOME/.local/go/bin:/usr/local/go/bin:/usr/local/node/bin:$PATH"
      export PATH="$HOME/.npm-global/bin:$PATH"
      
      # Ensure owner user owns all files
      sudo chown -R owner:owner "$HOME/claude" || true
      
      # Ensure Claude CLI pinned version is installed
      if [ -f "$HOME/claude/dev-worker/setup-claude.sh" ]; then
        CLAUDE_CLI_VERSION=1.0.77 bash "$HOME/claude/dev-worker/setup-claude.sh" || echo "Warning: setup-claude.sh failed"
      fi
      
      echo "Post-checkout hook completed"
